INFO:     Started server process [38200]
INFO:     Waiting for application startup.
INFO:     Application startup complete.
INFO:     Uvicorn running on http://0.0.0.0:9000 (Press CTRL+C to quit)
2025-10-04T02:34:28.367 | INFO | req= | route=/openapi.json | tenant=unknown | msg=START
INFO:     127.0.0.1:65490 - "GET /openapi.json HTTP/1.1" 200 OK
2025-10-04T02:34:28.465 | INFO | req= | route=/openapi.json | tenant=unknown | msg=END status=200 ms=101.0
2025-10-04T02:34:30.155 | INFO | req= | route=/auth/token | tenant=unknown | msg=START
INFO:     127.0.0.1:65493 - "POST /auth/token?username=po_admin&password=x HTTP/1.1" 200 OK
2025-10-04T02:34:30.187 | INFO | req= | route=/auth/token | tenant=unknown | msg=END status=200 ms=30.1
2025-10-04T02:34:30.195 | INFO | req= | route=/projects | tenant=unknown | msg=START
INFO:     127.0.0.1:65493 - "POST /projects?key=PX&name=Realtime%20Pricing&description=Smoke%20validation%20project HTTP/1.1" 409 Conflict
2025-10-04T02:34:30.212 | INFO | req= | route=/projects | tenant=tenant1 | msg=END status=409 ms=23.8
2025-10-04T02:34:30.228 | INFO | req= | route=/projects/PX | tenant=unknown | msg=START
INFO:     127.0.0.1:65493 - "GET /projects/PX HTTP/1.1" 200 OK
2025-10-04T02:34:30.243 | INFO | req= | route=/projects/PX | tenant=tenant1 | msg=END status=200 ms=24.2
2025-10-04T02:34:30.275 | INFO | req= | route=/upload | tenant=unknown | msg=START
2025-10-04T02:34:39.361 | INFO | req= | route= | tenant= | msg=Ingested chunks
2025-10-04T02:34:39.373 | INFO | req= | route= | tenant=tenant1 | msg=Stored fallback knowledge chunks
INFO:     127.0.0.1:65493 - "POST /upload HTTP/1.1" 200 OK
2025-10-04T02:34:39.389 | INFO | req= | route=/upload | tenant=tenant1 | msg=END status=200 ms=9113.9
2025-10-04T02:34:39.389 | INFO | req= | route=/retrieve | tenant=unknown | msg=START
2025-10-04T02:34:39.405 | INFO | req= | route= | tenant= | msg=PolicyPlan compiled
2025-10-04T02:34:40.457 | ERROR | req= | route= | tenant= | msg=Hybrid retriever crashed; switching to fallback
Traceback (most recent call last):
  File "C:\Users\rchan\OneDrive\Desktop\Git-Rajach-1854-11\North-Star\Src\backend\app\ports\retriever.py", line 114, in rag_search
    raw = hybrid_search(
  File "C:\Users\rchan\OneDrive\Desktop\Git-Rajach-1854-11\North-Star\Src\backend\app\adapters\hybrid_retriever.py", line 124, in search
    for point in qdrant_hybrid_search(
  File "C:\Users\rchan\OneDrive\Desktop\Git-Rajach-1854-11\North-Star\Src\backend\app\adapters\qdrant_client.py", line 156, in hybrid_search
    dense_points = client.search(
  File "C:\Users\rchan\OneDrive\Desktop\Git-Rajach-1854-11\venv\Lib\site-packages\qdrant_client\qdrant_client.py", line 353, in search
    return self._client.search(
  File "C:\Users\rchan\OneDrive\Desktop\Git-Rajach-1854-11\venv\Lib\site-packages\qdrant_client\qdrant_remote.py", line 518, in search
    search_result = self.http.points_api.search_points(
  File "C:\Users\rchan\OneDrive\Desktop\Git-Rajach-1854-11\venv\Lib\site-packages\qdrant_client\http\api\points_api.py", line 1388, in search_points
    return self._build_for_search_points(
  File "C:\Users\rchan\OneDrive\Desktop\Git-Rajach-1854-11\venv\Lib\site-packages\qdrant_client\http\api\points_api.py", line 636, in _build_for_search_points
    return self.api_client.request(
  File "C:\Users\rchan\OneDrive\Desktop\Git-Rajach-1854-11\venv\Lib\site-packages\qdrant_client\http\api_client.py", line 76, in request
    return self.send(request, type_)
  File "C:\Users\rchan\OneDrive\Desktop\Git-Rajach-1854-11\venv\Lib\site-packages\qdrant_client\http\api_client.py", line 99, in send
    raise UnexpectedResponse.for_response(response)
qdrant_client.http.exceptions.UnexpectedResponse: Unexpected Response: 400 (Bad Request)
Raw response content:
b'{"status":{"error":"Bad request: Index required but not found for \\"tenant_id\\" of one of the following types: [keyword]. Help: Create an index for this key or use a different filter."},"time":1.59 ...'
2025-10-04T02:34:40.472 | INFO | req= | route= | tenant= | msg=PolicyPlan execution summary
INFO:     127.0.0.1:65493 - "POST /retrieve HTTP/1.1" 200 OK
2025-10-04T02:34:40.488 | INFO | req= | route=/retrieve | tenant=tenant1 | msg=END status=200 ms=1086.5
2025-10-04T02:34:40.488 | INFO | req= | route=/staff/recommend | tenant=unknown | msg=START
INFO:     127.0.0.1:65493 - "GET /staff/recommend?project_id=1 HTTP/1.1" 200 OK
2025-10-04T02:34:40.520 | INFO | req= | route=/staff/recommend | tenant=tenant1 | msg=END status=200 ms=28.5
2025-10-04T02:34:40.520 | INFO | req= | route=/onboarding/generate | tenant=unknown | msg=START
2025-10-04T02:34:42.805 | ERROR | req= | route= | tenant= | msg=Tool 'rag_search' failed: rag_search_tool() got an unexpected keyword argument 'limit'
Traceback (most recent call last):
  File "C:\Users\rchan\OneDrive\Desktop\Git-Rajach-1854-11\North-Star\Src\backend\app\ports\planner.py", line 385, in execute_plan
    res = _TOOL_REGISTRY[tool](user_claims=user_claims, **args)
TypeError: rag_search_tool() got an unexpected keyword argument 'limit'
2025-10-04T02:34:43.980 | ERROR | req= | route= | tenant= | msg=Tool 'confluence_page' failed: Confluence responded with status 400
Traceback (most recent call last):
  File "C:\Users\rchan\OneDrive\Desktop\Git-Rajach-1854-11\North-Star\Src\backend\app\adapters\confluence_adapter.py", line 35, in resolve_space
    response.raise_for_status()
  File "C:\Users\rchan\OneDrive\Desktop\Git-Rajach-1854-11\venv\Lib\site-packages\httpx\_models.py", line 763, in raise_for_status
    raise HTTPStatusError(message, request=request, response=self)
httpx.HTTPStatusError: Client error '400 Bad Request' for url 'https://northstar-hackathon.atlassian.net/wiki/api/v2/spaces/PXSPACE'
For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\rchan\OneDrive\Desktop\Git-Rajach-1854-11\North-Star\Src\backend\app\ports\planner.py", line 385, in execute_plan
    res = _TOOL_REGISTRY[tool](user_claims=user_claims, **args)
  File "C:\Users\rchan\OneDrive\Desktop\Git-Rajach-1854-11\North-Star\Src\backend\app\agentic\tools.py", line 109, in confluence_page_tool
    space = confluence_adapter.resolve_space(space_key)
  File "C:\Users\rchan\OneDrive\Desktop\Git-Rajach-1854-11\North-Star\Src\backend\app\adapters\confluence_adapter.py", line 37, in resolve_space
    raise ExternalServiceError(f"Confluence responded with status {exc.response.status_code}") from exc
app.domain.errors.ExternalServiceError: Confluence responded with status 400
INFO:     127.0.0.1:65493 - "POST /onboarding/generate HTTP/1.1" 200 OK
2025-10-04T02:34:46.082 | INFO | req= | route=/onboarding/generate | tenant=tenant1 | msg=END status=200 ms=5563.9
2025-10-04T02:34:46.082 | INFO | req= | route=/agent/query | tenant=unknown | msg=START
2025-10-04T02:34:47.796 | ERROR | req= | route= | tenant= | msg=Tool 'confluence_page' failed: Confluence responded with status 400
Traceback (most recent call last):
  File "C:\Users\rchan\OneDrive\Desktop\Git-Rajach-1854-11\North-Star\Src\backend\app\adapters\confluence_adapter.py", line 35, in resolve_space
    response.raise_for_status()
  File "C:\Users\rchan\OneDrive\Desktop\Git-Rajach-1854-11\venv\Lib\site-packages\httpx\_models.py", line 763, in raise_for_status
    raise HTTPStatusError(message, request=request, response=self)
httpx.HTTPStatusError: Client error '400 Bad Request' for url 'https://northstar-hackathon.atlassian.net/wiki/api/v2/spaces/PXSPACE'
For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\rchan\OneDrive\Desktop\Git-Rajach-1854-11\North-Star\Src\backend\app\ports\planner.py", line 385, in execute_plan
    res = _TOOL_REGISTRY[tool](user_claims=user_claims, **args)
  File "C:\Users\rchan\OneDrive\Desktop\Git-Rajach-1854-11\North-Star\Src\backend\app\agentic\tools.py", line 109, in confluence_page_tool
    space = confluence_adapter.resolve_space(space_key)
  File "C:\Users\rchan\OneDrive\Desktop\Git-Rajach-1854-11\North-Star\Src\backend\app\adapters\confluence_adapter.py", line 37, in resolve_space
    raise ExternalServiceError(f"Confluence responded with status {exc.response.status_code}") from exc
app.domain.errors.ExternalServiceError: Confluence responded with status 400
2025-10-04T02:34:47.796 | INFO | req= | route= | tenant= | msg=PolicyPlan compiled
2025-10-04T02:34:50.425 | ERROR | req= | route= | tenant= | msg=Hybrid retriever crashed; switching to fallback
Traceback (most recent call last):
  File "C:\Users\rchan\OneDrive\Desktop\Git-Rajach-1854-11\North-Star\Src\backend\app\ports\retriever.py", line 114, in rag_search
    raw = hybrid_search(
  File "C:\Users\rchan\OneDrive\Desktop\Git-Rajach-1854-11\North-Star\Src\backend\app\adapters\hybrid_retriever.py", line 124, in search
    for point in qdrant_hybrid_search(
  File "C:\Users\rchan\OneDrive\Desktop\Git-Rajach-1854-11\North-Star\Src\backend\app\adapters\qdrant_client.py", line 156, in hybrid_search
    dense_points = client.search(
  File "C:\Users\rchan\OneDrive\Desktop\Git-Rajach-1854-11\venv\Lib\site-packages\qdrant_client\qdrant_client.py", line 353, in search
    return self._client.search(
  File "C:\Users\rchan\OneDrive\Desktop\Git-Rajach-1854-11\venv\Lib\site-packages\qdrant_client\qdrant_remote.py", line 518, in search
    search_result = self.http.points_api.search_points(
  File "C:\Users\rchan\OneDrive\Desktop\Git-Rajach-1854-11\venv\Lib\site-packages\qdrant_client\http\api\points_api.py", line 1388, in search_points
    return self._build_for_search_points(
  File "C:\Users\rchan\OneDrive\Desktop\Git-Rajach-1854-11\venv\Lib\site-packages\qdrant_client\http\api\points_api.py", line 636, in _build_for_search_points
    return self.api_client.request(
  File "C:\Users\rchan\OneDrive\Desktop\Git-Rajach-1854-11\venv\Lib\site-packages\qdrant_client\http\api_client.py", line 76, in request
    return self.send(request, type_)
  File "C:\Users\rchan\OneDrive\Desktop\Git-Rajach-1854-11\venv\Lib\site-packages\qdrant_client\http\api_client.py", line 99, in send
    raise UnexpectedResponse.for_response(response)
qdrant_client.http.exceptions.UnexpectedResponse: Unexpected Response: 400 (Bad Request)
Raw response content:
b'{"status":{"error":"Bad request: Index required but not found for \\"tenant_id\\" of one of the following types: [keyword]. Help: Create an index for this key or use a different filter."},"time":1.43 ...'
2025-10-04T02:34:50.425 | INFO | req= | route= | tenant= | msg=PolicyPlan execution summary
2025-10-04T02:34:53.369 | INFO | req= | route= | tenant= | msg=publish_artifact:jira_epic
2025-10-04T02:34:54.350 | ERROR | req= | route= | tenant= | msg=Tool 'confluence_page' failed: Confluence responded with status 400
Traceback (most recent call last):
  File "C:\Users\rchan\OneDrive\Desktop\Git-Rajach-1854-11\North-Star\Src\backend\app\adapters\confluence_adapter.py", line 35, in resolve_space
    response.raise_for_status()
  File "C:\Users\rchan\OneDrive\Desktop\Git-Rajach-1854-11\venv\Lib\site-packages\httpx\_models.py", line 763, in raise_for_status
    raise HTTPStatusError(message, request=request, response=self)
httpx.HTTPStatusError: Client error '400 Bad Request' for url 'https://northstar-hackathon.atlassian.net/wiki/api/v2/spaces/PXSPACE'
For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\rchan\OneDrive\Desktop\Git-Rajach-1854-11\North-Star\Src\backend\app\ports\planner.py", line 385, in execute_plan
    res = _TOOL_REGISTRY[tool](user_claims=user_claims, **args)
  File "C:\Users\rchan\OneDrive\Desktop\Git-Rajach-1854-11\North-Star\Src\backend\app\agentic\tools.py", line 109, in confluence_page_tool
    space = confluence_adapter.resolve_space(space_key)
  File "C:\Users\rchan\OneDrive\Desktop\Git-Rajach-1854-11\North-Star\Src\backend\app\adapters\confluence_adapter.py", line 37, in resolve_space
    raise ExternalServiceError(f"Confluence responded with status {exc.response.status_code}") from exc
app.domain.errors.ExternalServiceError: Confluence responded with status 400
INFO:     127.0.0.1:65493 - "POST /agent/query HTTP/1.1" 200 OK
2025-10-04T02:34:54.350 | INFO | req= | route=/agent/query | tenant=tenant1 | msg=END status=200 ms=8269.2
2025-10-04T02:34:54.366 | INFO | req= | route=/skills/profile | tenant=unknown | msg=START
INFO:     127.0.0.1:65493 - "GET /skills/profile?developer_id=1 HTTP/1.1" 200 OK
2025-10-04T02:34:54.382 | INFO | req= | route=/skills/profile | tenant=tenant1 | msg=END status=200 ms=16.6
2025-10-04T02:34:54.382 | INFO | req= | route=/audit | tenant=unknown | msg=START
INFO:     127.0.0.1:65493 - "GET /audit?limit=20 HTTP/1.1" 200 OK
2025-10-04T02:34:54.414 | INFO | req= | route=/audit | tenant=tenant1 | msg=END status=200 ms=24.9
2025-10-04T02:34:54.414 | INFO | req= | route=/events/github | tenant=unknown | msg=START
INFO:     127.0.0.1:65493 - "POST /events/github HTTP/1.1" 200 OK
2025-10-04T02:34:55.018 | INFO | req= | route=/events/github | tenant=unknown | msg=END status=200 ms=598.0
